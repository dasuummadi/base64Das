<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base64 Encoder/Decoder & AES Encryptor/Decryptor</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600&display=swap">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to right, #add8e6, #87ceeb, #4682b4, #5f9ea0);
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            overflow: hidden;
            border-radius: 24px; /* Increased rounded corners for the body container */
        }

        .container {
            width: 90%;
            max-width: 1300px;
            height: 90%;
            padding: 20px;
            background: #fff;
            color: #333;
            border-radius: 16px; /* Increased rounded corners for the main container */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-align: center;
            overflow-y: auto;
        }

        /* Remove .textarea-wrapper and .line-numbers styles */
        textarea, input[type="text"], input[type="file"], select {
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 10px;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            background-color: #f9f9f9;
            resize: vertical; /* allow vertical resizing */
            min-height: 40px;
            max-height: 600px;
            overflow-y: auto;
            transition: height 0.2s;
        }

        button {
            display: inline-block;
            margin: 5px 10px;
            padding: 12px 24px;
            border: none;
            background: linear-gradient(to right, #87cefa, #1e90ff);
            color: white;
            cursor: pointer;
            border-radius: 8px; /* Increased rounded corners for buttons */
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        button:hover {
            background: linear-gradient(to right, #6ca6cd, #4682b4);
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #005f73; /* Changed title color */
            letter-spacing: 1px;
        }

        h2 {
            font-size: 22px;
            font-weight: 600;
            margin: 20px 0 10px;
            color: #333;
        }

        .section {
            display: none;
        }

        .progress-bar-container {
            width: 100%;
            background-color: #f3f3f3;
            border-radius: 8px; /* Increased rounded corners for progress bar container */
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-bar {
            width: 0;
            height: 20px;
            /* Updated gradient for more beautiful color */
            background: linear-gradient(90deg, #ffecd2 0%, #fcb69f 25%, #a1c4fd 50%, #c2e9fb 75%, #667eea 100%);
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
        }

        .error-message {
            color: red;
            margin-top: 10px;
        }

        .download-link {
            display: none;
            margin-top: 10px;
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px; /* Increased rounded corners for images */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .pdf-download-container {
            text-align: center;
            margin-top: 10px;
        }

        a.download-link {
            text-decoration: none;
            color: #1e90ff;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        a.download-link:hover {
            color: #4682b4;
        }

        /* Remove .textarea-wrapper and .line-numbers CSS */
        .textarea-wrapper {
            display: flex;
            align-items: stretch;
            width: 100%;
            position: relative;
        }
        .line-numbers {
            background: #f7fafc;
            color: #aaa;
            font-family: monospace;
            font-size: 15px;
            text-align: right;
            padding: 12px 6px 12px 0;
            border-right: 1px solid #ccc;
            user-select: none;
            min-width: 32px;
            max-width: 40px;
            overflow: hidden;
        }
        .textarea-wrapper textarea {
            border-left: none;
            border-radius: 0 8px 8px 0;
            margin-bottom: 0;
        }

        /* Section heading colors */
        #text-section h2 { color: #0077b6; }
        #image-section h2 { color: #8d5fd3; }
        #pdf-section h2 { color: #e76f51; }
        #xml-section h2 { color: #2a9d8f; }
        #message-section h2 { color: #e9c46a; }
        #zip-section h2 { color: #264653; }
        #unzip-section h2 { color: #f94144; }
        #jwt-section h2 { color: #43aa8b; }
        #json2str-section h2 { color: #f3722c; }
        #str2json-section h2 { color: #277da1; }
        #jsonbeautify-section h2 { color: #b5179e; }

        @media (max-height: 600px) {
            .container {
                height: auto;
                overflow-y: auto;
                padding-bottom: 20px;
            }
        }

        select#operation-selector {
            /* ...existing code... */
            max-width: 100%;
            /* Add these lines for dropdown scroll */
            max-height: 60px;
            overflow-y: auto;
        }
        /* For Chrome, Safari, Edge */
        select#operation-selector:focus option {
            max-height: 200px;
            overflow-y: auto;
        }
        /* For Firefox */
        select#operation-selector option {
            max-height: 200px;
        }

        .download-indicator {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 8px;
            text-align: center;
            color: #1976d2;
            font-weight: 600;
        }

        .download-indicator.active {
            display: block;
        }

        /* Welcome screen animation styles */
        #welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: fadeOut 0.8s ease-in-out 5s forwards;
        }

        #welcome-title {
            font-size: 72px;
            font-weight: 700;
            color: #fff;
            text-align: center;
            letter-spacing: 8px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5), 0 0 40px rgba(255, 255, 255, 0.3);
            animation: titleAnimation 4.5s ease-in-out;
        }

        @keyframes titleAnimation {
            0% {
                opacity: 0;
                transform: scale(0.5) rotateY(-180deg);
                filter: blur(10px);
            }
            40% {
                opacity: 1;
                transform: scale(1.1) rotateY(0deg);
                filter: blur(0px);
            }
            60% {
                transform: scale(0.95) rotateY(0deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotateY(0deg);
                filter: blur(0px);
            }
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                visibility: visible;
            }
            100% {
                opacity: 0;
                visibility: hidden;
            }
        }

        /* Particle animation for welcome screen */
        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
        }

        /* Hide main container initially */
        .container {
            animation: fadeIn 0.8s ease-in-out 5s forwards;
            opacity: 0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            #welcome-title {
                font-size: 48px;
                letter-spacing: 4px;
            }
        }

        @media (max-width: 480px) {
            #welcome-title {
                font-size: 36px;
                letter-spacing: 2px;
            }
        }

        /* ...existing code... */
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcome-screen">
        <h1 id="welcome-title">DasBase64</h1>
    </div>

    <div class="container">
        <h1>Base64-XML-Encryption-Decryption-zip</h1>

        <select id="operation-selector" onchange="showSection()">
            <option value="">Select Operation</option>
            <option value="text">Base64-Encode-Decode</option>
            <option value="image">Base64-Encode-Decode-Image</option>
            <option value="pdf">Base64-Encode-Decode-PDF</option>
            <option value="xml">XML-EncodeDecode</option>
            <option value="message">Encrypt-Decrypt-Keys</option>
            <option value="zip">Zip-File </option>
            <option value="unzip">Unzip-File</option>
            <option value="jwt">Genrate-JWT</option>
            <option value="json2str">JSON to String Converter</option>
            <option value="str2json">String to JSON Converter</option>
            <option value="jsonbeautify">JSON Beautifier</option>
            <option value="jsoncompare">JSON Compare</option>
            <option value="xmlcompare">XML Compare</option>
        </select>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>




<div id="jwt-section" class="section">
    <h2>JWT Encoder/Decoder</h2>
    <textarea id="credentials-input" rows="4" placeholder="Enter credentials in format: username|userid|userlicense|password"></textarea>
    <input type="text" id="jwt-secret-input" placeholder="Enter secret key (optional)">
    <input type="number" id="jwt-expiry-input" placeholder="Enter expiry time in hours">
    <button onclick="createJwt()">Create JWT</button>
    <textarea class="result-textarea" id="jwt-result" placeholder="Generated JWT will appear here"></textarea>
    <textarea class="result-textarea" id="jwt-decode-input" placeholder="Enter JWT to Decode"></textarea>
    <button onclick="decodeJwt()">Decode JWT</button>
    <div id="jwt-decode-result-container">
        <h3>Result:</h3>
        <div id="jwt-decode-result" class="result-textarea" style="display: flex; align-items: center;">
            <button onclick="copyToClipboard()" style="border: none; background: none; cursor: pointer;">
                <img src="https://cdn-icons-png.flaticon.com/512/60/60772.png" alt="Copy" style="width: 20px;">
            </button>
            <span id="jwt-decode-display" style="white-space: pre-wrap;"></span>
        </div>
    </div>
    <div id="jwt-expiry" class="result-textarea"></div>
</div>


      <div id="zip-section" class="section">
    <h2>Zip File Conversion</h2>
    <input type="file" id="zip-input" multiple>
    <button onclick="zipFiles()">Zip</button>
    <textarea class="result-textarea" id="zip-result" placeholder="Base64 Zip file will appear here"></textarea>
    <button onclick="decodeZipBase64()">Decode Base64 to Zip</button>
    <div class="download-link-container">
        <a id="download-zip-link" class="download-link" style="display:none;" download="files.zip">Download Zipped File</a>
    </div>
</div>

<div id="unzip-section" class="section">
    <h2>Unzip  The File</h2>
    <input type="file" id="unzip-input">
    <button onclick="unzipFile()">Unzip</button>
    <textarea class="result-textarea" id="unzip-base64-input" placeholder="Or enter Base64 zip to unzip"></textarea>
    <button onclick="unzipFromBase64()">Unzip from Base64</button>
    <div id="unzipped-files-container"></div>
</div>

        <div id="text-section" class="section">
            <h2>Base64-Encode-Decode</h2>
            <textarea id="text-input" rows="4" placeholder="Enter text to encode"></textarea>
            <button onclick="encodeText()">Encode</button>
            <textarea class="result-textarea" id="encoded-text-result" placeholder="Encoded text will appear here"></textarea>
            <button onclick="decodeText()">Decode</button>
            <textarea class="result-textarea" id="decoded-text-result" placeholder="Decoded text will appear here"></textarea>
        </div>

        <div id="image-section" class="section">
            <h2>Base64-Encode-Decode-Image</h2>
            <input type="file" id="image-input" accept="image/*,.tiff,.tif">
            <button onclick="encodeImage()">Encode</button>
            <textarea class="result-textarea" id="image-encoded-result" placeholder="Encoded image base64 will appear here"></textarea>
            <button onclick="decodeImage()">Decode</button>
            <div class="image-container">
                <canvas id="canvas"></canvas>
                <img id="image-result" src="#" alt="Decoded Image" style="display:none;">
                <div id="image-download-indicator" class="download-indicator">⏳ Preparing download...</div>
                <a id="download-link" class="download-link" download="decoded-image.jpg">Download Decoded Image</a>
                <!-- Progress bar for image download -->
                <div id="image-download-progress-container" class="progress-bar-container" style="display:none;">
                    <div id="image-download-progress-bar" class="progress-bar"></div>
                </div>
                <div id="image-error" class="error-message" style="display:none;">Invalid Base64 string for image.</div>
            </div>
        </div>

        <div id="pdf-section" class="section">
            <h2>Base64-Encode-Decode-PDF</h2>
            <input type="file" id="pdf-input" accept=".pdf">
            <button onclick="encodePDF()">Encode</button>
            <textarea class="result-textarea" id="pdf-encoded-result" placeholder="Encoded PDF Base64 will appear here"></textarea>
            <textarea class="result-textarea" id="pdf-encoded-input" placeholder="Enter Base64 PDF to Decode"></textarea>
            <button onclick="decodePDF()">Decode</button>
            <div class="pdf-download-container">
                <div id="pdf-download-indicator" class="download-indicator">⏳ Preparing PDF download...</div>
                <div style="display: flex; gap: 10px; justify-content: center; align-items: center; margin-top: 10px;">
                    <a id="pdf-result" class="download-link" style="display:none;" download="decoded.pdf">Download Decoded PDF</a>
                    <a id="doc-result" class="download-link" style="display:none;" download="decoded.doc">Download as DOC</a>
                </div>
                <!-- Progress bar for PDF download -->
                <div id="pdf-download-progress-container" class="progress-bar-container" style="display:none;">
                    <div id="pdf-download-progress-bar" class="progress-bar"></div>
                </div>
            </div>
        </div>

        <div id="xml-section" class="section">
            <h2>XML-EncodeDecode</h2>
            <textarea id="xml-input" rows="4" placeholder="Enter XML content to encode"></textarea>
            <button onclick="encodeXML()">Encode</button>
            <textarea class="result-textarea" id="encoded-xml-result" placeholder="Encoded XML Base64 will appear here"></textarea>
            <textarea class="result-textarea" id="xml-encoded-input" placeholder="Enter Base64 XML to Decode"></textarea>
            <button onclick="decodeXML()">Decode</button>
            <textarea class="result-textarea" id="decoded-xml-result" placeholder="Decoded XML will appear here"></textarea>
        </div>

        <div id="message-section" class="section">
            <h2>Encrypt-Decrypt-Keys</h2>
            <textarea id="message-input" rows="4" placeholder="Enter message to encrypt"></textarea>
            <input type="text" id="key-input" placeholder="Enter encryption key (32 characters)">
            <button onclick="encryptMessage()">Encrypt</button>
            <textarea class="result-textarea" id="encrypted-message-result" placeholder="Encrypted message will appear here"></textarea>
            <button onclick="decryptMessage()">Decrypt</button>
            <textarea class="result-textarea" id="decrypted-message-result" placeholder="Decrypted message will appear here"></textarea>
        </div>

        <div id="json2str-section" class="section">
            <h2>JSON to String Converter</h2>
            <textarea id="json2str-input" rows="4" placeholder="Enter JSON here"></textarea>
            <button onclick="jsonToString()">Convert to String</button>
            <textarea class="result-textarea" id="json2str-result" placeholder="String result will appear here"></textarea>
        </div>

        <div id="str2json-section" class="section">
            <h2>String to JSON Converter</h2>
            <textarea id="str2json-input" rows="4" placeholder="Enter String here"></textarea>
            <button onclick="stringToJson()">Convert to JSON</button>
            <textarea class="result-textarea" id="str2json-result" placeholder="JSON result will appear here"></textarea>
        </div>

        <!-- JSON Beautifier section UI with collapsible JSON viewer and line numbers -->
        <div id="jsonbeautify-section" class="section">
            <h2>JSON Beautifier</h2>
            <div style="display: flex; gap: 16px; justify-content: center; align-items: flex-start;">
                <div style="flex:1; min-width: 0;">
                    <label for="jsonbeautify-input" style="font-weight:600; display:block; margin-bottom:4px;">Input JSON</label>
                    <div style="position:relative; width:100%;">
                        <textarea id="jsonbeautify-input" rows="16" style="width:100%; min-width:200px; resize:vertical; font-family:monospace; font-size:15px; padding-left:40px; box-sizing:border-box;" placeholder="Paste minified or ugly JSON here"></textarea>
                        <div id="jsonbeautify-input-lines"
                            style="position:absolute;top:0;left:0;bottom:0;width:32px;overflow:hidden;
                            background:#f7fafc;border-right:1px solid #ccc;text-align:right;user-select:none;
                            color:#aaa;font-family:monospace;font-size:15px;line-height:1.5;padding:12px 4px 12px 0;pointer-events:none;">
                        </div>
                    </div>
                </div>
                <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; margin-top:32px;">
                    <button onclick="beautifyJson()" title="Beautify" style="padding: 8px 18px; font-size:18px; border-radius:50%; background:#e2e8f0; color:#333; border:1px solid #bfc9d1; box-shadow:0 2px 6px rgba(0,0,0,0.07); margin-bottom:8px; cursor:pointer;">
                        <span style="font-size:20px;">&#8594;</span>
                    </button>
                </div>
                <div style="flex:1; min-width: 0;">
                    <label for="jsonbeautify-output" style="font-weight:600; display:block; margin-bottom:4px;">Beautified JSON</label>
                    <div style="display:flex;">
                        <div id="json-line-numbers" style="background:#f7fafc;border-right:1px solid #ccc;padding:8px 4px 8px 0;text-align:right;user-select:none;color:#aaa;font-family:monospace;font-size:15px;min-width:32px;"></div>
                        <div id="json-collapsible-viewer" style="width:100%; min-width:200px; background:#f7fafc; border-radius:8px; border:1px solid #ccc; border-left:none; padding:8px; font-family:monospace; font-size:15px; text-align:left; min-height:350px; max-height:500px; overflow:auto;"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="jsoncompare-section" class="section">
            <h2>JSON Compare</h2>
            <div style="display: flex; gap: 16px; justify-content: center;">
                <div style="flex:1;">
                    <label style="font-weight:600; display:block; margin-bottom:4px;">JSON 1</label>
                    <textarea id="json-compare-1" rows="12" placeholder="Enter first JSON"></textarea>
                </div>
                <div style="flex:1;">
                    <label style="font-weight:600; display:block; margin-bottom:4px;">JSON 2</label>
                    <textarea id="json-compare-2" rows="12" placeholder="Enter second JSON"></textarea>
                </div>
            </div>
            <button onclick="compareJson()">Compare</button>
            <div id="json-compare-result" style="margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; min-height: 100px; white-space: pre-wrap; font-family: monospace;"></div>
        </div>

        <div id="xmlcompare-section" class="section">
            <h2>XML Compare</h2>
            <div style="display: flex; gap: 16px; justify-content: center;">
                <div style="flex:1;">
                    <label style="font-weight:600; display:block; margin-bottom:4px;">XML 1</label>
                    <textarea id="xml-compare-1" rows="12" placeholder="Enter first XML"></textarea>
                </div>
                <div style="flex:1;">
                    <label style="font-weight:600; display:block; margin-bottom:4px;">XML 2</label>
                    <textarea id="xml-compare-2" rows="12" placeholder="Enter second XML"></textarea>
                </div>
            </div>
            <button onclick="compareXml()">Compare</button>
            <div id="xml-compare-result" style="margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; min-height: 100px; white-space: pre-wrap; font-family: monospace;"></div>
        </div>

    </div>

     
 <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>
    <script>
        // Create floating particles for welcome screen
        function createParticles() {
            const welcomeScreen = document.getElementById('welcome-screen');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 5 + 's';
                particle.style.animationDuration = (Math.random() * 2 + 3) + 's';
                welcomeScreen.appendChild(particle);
            }
        }

        // Initialize particles on page load
        window.addEventListener('DOMContentLoaded', function() {
            createParticles();
            
            // Remove welcome screen from DOM after animation
            setTimeout(() => {
                const welcomeScreen = document.getElementById('welcome-screen');
                if (welcomeScreen) {
                    welcomeScreen.remove();
                }
            }, 6000);
        });

        function showSection() {
            const progressBar = document.getElementById('progress-bar');
            const operation = document.getElementById('operation-selector').value;

            progressBar.style.width = '100%';

            document.getElementById('text-section').style.display = 'none';
            document.getElementById('image-section').style.display = 'none';
            document.getElementById('pdf-section').style.display = 'none';
            document.getElementById('xml-section').style.display = 'none';
            document.getElementById('message-section'). style.display = 'none';
            document.getElementById('zip-section').style.display = 'none';
            document.getElementById('unzip-section').style.display = 'none';
            document.getElementById('jwt-section').style.display = 'none';
            document.getElementById('json2str-section').style.display = 'none';
            document.getElementById('str2json-section').style.display = 'none';
            document.getElementById('jsonbeautify-section').style.display = 'none'; // add this
            document.getElementById('jsoncompare-section').style.display = 'none';
            document.getElementById('xmlcompare-section').style.display = 'none';

            clearAllInputs();

            if (operation === 'text') {
                document.getElementById('text-section').style.display = 'block';
            } else if (operation === 'image') {
                document.getElementById('image-section').style.display = 'block';
            } else if (operation === 'pdf') {
                document.getElementById('pdf-section').style.display = 'block';
            } else if (operation === 'xml') {
                document.getElementById('xml-section').style.display = 'block';
            } else if (operation === 'message') {
                document.getElementById('message-section').style.display = 'block';
            } else if (operation === 'zip') {
                document.getElementById('zip-section').style.display = 'block';
            } else if (operation === 'unzip') {
                document.getElementById('unzip-section').style.display = 'block';
            } else if (operation === 'jwt') {
                document.getElementById('jwt-section').style.display = 'block';
            } else if (operation === 'json2str') {
                document.getElementById('json2str-section').style.display = 'block';
            } else if (operation === 'str2json') {
                document.getElementById('str2json-section').style.display = 'block';
            } else if (operation === 'jsonbeautify') {
                document.getElementById('jsonbeautify-section').style.display = 'block';
            } else if (operation === 'jsoncompare') {
                document.getElementById('jsoncompare-section').style.display = 'block';
            } else if (operation === 'xmlcompare') {
                document.getElementById('xmlcompare-section').style.display = 'block';
            }

            setTimeout(() => {
                progressBar.style.width = '0'; // Reset the progress bar
            }, 1000);
        }

        function clearAllInputs() {
            document.getElementById('text-input').value = '';
            document.getElementById('encoded-text-result').value = '';
            document.getElementById('decoded-text-result').value = '';

            document.getElementById('image-input').value = '';
            document.getElementById('image-encoded-result').value = '';
            document.getElementById('image-result').style.display = 'none';
            document.getElementById('download-link').style.display = 'none';
            document.getElementById('image-error').style.display = 'none';

            document.getElementById('pdf-encoded-input').value = '';
            document.getElementById('pdf-encoded-result').value = '';
            document.getElementById('pdf-result').style.display = 'none';
            document.getElementById('doc-result').style.display = 'none';

            document.getElementById('xml-input').value = '';
            document.getElementById('encoded-xml-result').value = '';
            document.getElementById('xml-encoded-input').value = '';
            document.getElementById('decoded-xml-result').value = '';

            document.getElementById('message-input').value = '';
            document.getElementById('key-input').value = '';
            document.getElementById('encrypted-message-result').value = '';
            document.getElementById('decrypted-message-result').value = '';

            // Clear zip section inputs
            document.getElementById('zip-input').value = '';
            document.getElementById('zip-result').value = '';
            document.getElementById('download-zip-link').style.display = 'none';

            // Clear unzip section inputs
            document.getElementById('unzip-input').value = '';
            document.getElementById('unzipped-files-container').innerHTML = '';

            document.getElementById('credentials-input').value = ''; // Clear JWT inputs
            document.getElementById('jwt-secret-input').value = '';
            document.getElementById('jwt-result').value = '';
            document.getElementById('jwt-decode-input').value = '';
            document.getElementById('jwt-decode-display').innerText = '';
            document.getElementById('jwt-expiry').innerHTML = '';

            // Clear JSON to String Converter inputs
            document.getElementById('json2str-input').value = '';
            document.getElementById('json2str-result').value = '';

            // Clear String to JSON Converter inputs
            document.getElementById('str2json-input').value = '';
            document.getElementById('str2json-result').value = '';

            document.getElementById('jsonbeautify-input') && (document.getElementById('jsonbeautify-input').value = '');
            // Clear the JSON Beautifier viewer and line numbers as well
            document.getElementById('json-collapsible-viewer') && (document.getElementById('json-collapsible-viewer').innerHTML = '');
            document.getElementById('json-line-numbers') && (document.getElementById('json-line-numbers').innerHTML = '');

            // Clear JSON Compare inputs
            document.getElementById('json-compare-1') && (document.getElementById('json-compare-1').value = '');
            document.getElementById('json-compare-2') && (document.getElementById('json-compare-2').value = '');
            document.getElementById('json-compare-result') && (document.getElementById('json-compare-result').innerHTML = '');

            // Clear XML Compare inputs
            document.getElementById('xml-compare-1') && (document.getElementById('xml-compare-1').value = '');
            document.getElementById('xml-compare-2') && (document.getElementById('xml-compare-2').value = '');
            document.getElementById('xml-compare-result') && (document.getElementById('xml-compare-result').innerHTML = '');
        }


        function isValidBase64String(base64String) {
            const regex = /^([0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/;
            return regex.test(base64String);
        }

        function encodeText() {
            const text = document.getElementById('text-input').value;
            const encodedText = btoa(text);
            document.getElementById('encoded-text-result').value = encodedText;
        }

        function decodeText() {
            const encodedText = document.getElementById('encoded-text-result').value;
            try {
                const decodedText = atob(encodedText);
                document.getElementById('decoded-text-result').value = decodedText;
            } catch (e) {
                document.getElementById('decoded-text-result').value = 'Invalid Base64 string.';
            }
        }

        function encodeImage() {
            const file = document.getElementById('image-input').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function () {
                    // Detect TIFF
                    let mimeType = file.type;
                    if (!mimeType) {
                        if (file.name.toLowerCase().endsWith('.tiff') || file.name.toLowerCase().endsWith('.tif')) {
                            mimeType = 'image/tiff';
                        } else {
                            mimeType = 'image/jpeg';
                        }
                    }
                    const base64String = reader.result.split(',')[1];
                    document.getElementById('image-encoded-result').value = base64String;
                    document.getElementById('image-result').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function decodeImage() {
            const base64String = document.getElementById('image-encoded-result').value;
            const imageError = document.getElementById('image-error');
            const displayImage = document.getElementById('image-result');
            const downloadLink = document.getElementById('download-link');
            const downloadIndicator = document.getElementById('image-download-indicator');
            
            // Show indicator
            downloadIndicator.classList.add('active');
            
            // TIFF detection by extension or magic number (SUkq)
            let mimeType = 'image/jpeg';
            if (base64String.length > 100 && base64String.substring(0, 10).includes('SUkq')) {
                mimeType = 'image/tiff';
            }
            if (isValidBase64String(base64String)) {
                imageError.style.display = 'none';
                const imgSrc = 'data:' + mimeType + ';base64,' + base64String;
                displayImage.src = imgSrc;
                displayImage.style.display = 'block';
                downloadLink.href = imgSrc;
                downloadLink.download = mimeType === 'image/tiff' ? 'decoded-image.tiff' : 'decoded-image.jpg';
                
                // Hide indicator and show download link after a short delay
                setTimeout(() => {
                    downloadIndicator.classList.remove('active');
                    downloadLink.style.display = 'inline-block';
                }, 800);
            } else {
                displayImage.style.display = 'none';
                downloadLink.style.display = 'none';
                downloadIndicator.classList.remove('active');
                imageError.style.display = 'block';
            }
        }

        function encodePDF() {
            const file = document.getElementById('pdf-input').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function () {
                    const base64String = reader.result.split(',')[1];
                    document.getElementById('pdf-encoded-result').value = base64String;
                };
                reader.readAsDataURL(file);
            }
        }

        function decodePDF() {
            const base64String = document.getElementById('pdf-encoded-input').value;
            const pdfLink = document.getElementById('pdf-result');
            const docLink = document.getElementById('doc-result');
            const downloadIndicator = document.getElementById('pdf-download-indicator');

            // Show indicator
            downloadIndicator.classList.add('active');

            if (isValidBase64String(base64String)) {
                const pdfData = Uint8Array.from(atob(base64String), c => c.charCodeAt(0));
                const pdfBlob = new Blob([pdfData], { type: 'application/pdf' });
                const pdfUrl = URL.createObjectURL(pdfBlob);
                
                // Set PDF download link
                pdfLink.href = pdfUrl;
                
                // Create DOC version (RTF format for better compatibility)
                // Note: This creates a simple RTF document with the PDF content as binary data
                // For true PDF to DOC conversion, server-side processing would be needed
                const docBlob = new Blob([pdfData], { type: 'application/msword' });
                docLink.href = URL.createObjectURL(docBlob);
                
                // Simulate delay for large PDFs
                setTimeout(() => {
                    downloadIndicator.classList.remove('active');
                    pdfLink.style.display = 'inline-block';
                    docLink.style.display = 'inline-block';
                }, 1200);
            } else {
                pdfLink.style.display = 'none';
                docLink.style.display = 'none';
                downloadIndicator.classList.remove('active');
                alert('Invalid Base64 string for PDF.');
            }
        }

        function encodeXML() {
            const xml = document.getElementById('xml-input').value;
            const encodedXML = btoa(xml);
            document.getElementById('encoded-xml-result').value = encodedXML;
        }

        function decodeXML() {
            const encodedXML = document.getElementById('xml-encoded-input').value;
            try {
                const decodedXML = atob(encodedXML);
                document.getElementById('decoded-xml-result').value = decodedXML;
            } catch (e) {
                document.getElementById('decoded-xml-result').value = 'Invalid Base64 string.';
            }
        }

      function encryptMessage() {
            const message = document.getElementById('message-input').value;
            const key = document.getElementById('key-input').value;

            if (!message || !key) {
                document.getElementById('encrypted-message-result').value = 'Message and key are required.';
                return;
            }

            if (key.length !== 32) {
                document.getElementById('encrypted-message-result').value = 'Key must be 32 characters long.';
                return;
            }

            const encrypted = CryptoJS.AES.encrypt(message, key).toString();
            document.getElementById('encrypted-message-result').value = encrypted;
        }

        function decryptMessage() {
            const encryptedMessage = document.getElementById('encrypted-message-result').value;
            const key = document.getElementById('key-input').value;

            if (!encryptedMessage || !key) {
                document.getElementById('decrypted-message-result').value = 'Message and key are required.';
                return;
            }

            if (key.length !== 32) {
                document.getElementById('decrypted-message-result').value = 'Key must be 32 characters long.';
                return;
            }

            const decrypted = CryptoJS.AES.decrypt(encryptedMessage, key).toString(CryptoJS.enc.Utf8);
            if (!decrypted) {
                document.getElementById('decrypted-message-result').value = 'Invalid Encrypted Message or Key!';
            } else {
                document.getElementById('decrypted-message-result').value = decrypted;
            }
        }




function copyToClipboard() {
    const resultText = document.getElementById('jwt-decode-display').innerText;
    navigator.clipboard.writeText(resultText).then(() => {
        alert('Copied to clipboard!');
    }).catch(err => {
        alert('Failed to copy: ' + err);
    });
}

function createJwt() {
    // Simulate C# Encrypt(username) with base64 (replace with real encryption if needed)
    const credentials = document.getElementById('credentials-input').value;
    const validity = parseInt(document.getElementById('jwt-expiry-input').value) || 60; // minutes
    const secret = "";
    if (!credentials) {
        document.getElementById('jwt-result').value = 'Username is required';
        return;
    }
    // Encrypt username (simulate)
    const encryptedUsername = btoa(credentials);

    // JWT header
    const header = {
        alg: "HS256",
        typ: "JWT"
    };
    // JWT payload
    const payload = {
        name: encryptedUsername,
        exp: Math.floor(Date.now() / 1000) + validity * 60
    };

    // Base64Url encode
    function base64UrlEncode(obj) {
        return btoa(JSON.stringify(obj))
            .replace(/=/g, '')
            .replace(/\+/g, '-')
            .replace(/\//g, '_');
    }

    const encodedHeader = base64UrlEncode(header);
    const encodedPayload = base64UrlEncode(payload);
    const data = encodedHeader + "." + encodedPayload;

    // HMACSHA256 signature
    function base64UrlFromWordArray(wordArray) {
        return CryptoJS.enc.Base64.stringify(wordArray)
            .replace(/=/g, '')
            .replace(/\+/g, '-')
            .replace(/\//g, '_');
    }
    // Convert base64 secret to WordArray
    const key = CryptoJS.enc.Base64.parse(secret);
    const signature = CryptoJS.HmacSHA256(data, key);
    const encodedSignature = base64UrlFromWordArray(signature);

    const jwt = data + "." + encodedSignature;
    document.getElementById('jwt-result').value = jwt;
}

function decodeJwt() {
    const jwt = document.getElementById('jwt-decode-input').value;

    if (!jwt) {
        document.getElementById('jwt-decode-display').innerText = 'JWT is required';
        document.getElementById('jwt-expiry').innerText = '';
        return;
    }

    const parts = jwt.split('.');
    if (parts.length !== 3) {
        document.getElementById('jwt-decode-display').innerText = 'JWT format is invalid';
        document.getElementById('jwt-expiry').innerText = '';
        return;
    }

    try {
        const payload = JSON.parse(atob(parts[1]));

        // Decode the username if present
        let username = payload.name ? atob(payload.name) : '';
        let userId = payload.userId || '';
        let userLicense = payload.userLicense || '';
        let password = payload.password || '';

        const displayText = `${username}|${userId}|${userLicense}|${password}`;

        document.getElementById('jwt-decode-display').innerText = displayText;

        const expiryTime = payload.exp ? new Date(payload.exp * 1000) : 'No expiry';
        document.getElementById('jwt-expiry').innerHTML = `<strong>Expiry Time:</strong> ${expiryTime}`;
    } catch (error) {
        document.getElementById('jwt-decode-display').innerText = 'Error decoding JWT';
        document.getElementById('jwt-expiry').innerText = '';
    }
}

async function zipFiles() {
    const files = document.getElementById('zip-input').files;
    if (files.length === 0) {
        alert('Please select files to zip');
        return;
    }

    const zip = new JSZip();
    for (const file of files) {
        zip.file(file.name, file);
    }

    const base64zip = await zip.generateAsync({ type: "base64" });
    document.getElementById('zip-result').value = base64zip;

    const downloadLink = document.getElementById('download-zip-link');
    downloadLink.href = "data:application/zip;base64," + base64zip;
    downloadLink.style.display = 'inline-block';
}

async function decodeZipBase64() {
    const base64String = document.getElementById('zip-result').value;
    if (!base64String) {
        alert('Please enter Base64 zip data');
        return;
    }

    try {
        const binaryString = atob(base64String);
        const bytes = new Uint8Array(binaryString.length);
        for (let i = 0; i < binaryString.length; i++) {
            bytes[i] = binaryString.charCodeAt(i);
        }
        const blob = new Blob([bytes], { type: 'application/zip' });
        const downloadLink = document.getElementById('download-zip-link');
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.style.display = 'inline-block';
        alert('Zip file ready for download');
    } catch (e) {
        alert('Invalid Base64 zip data');
    }
}

async function unzipFile() {
    const file = document.getElementById('unzip-input').files[0];
    if (!file) {
        alert('Please select a zip file');
        return;
    }

    const unzippedFilesContainer = document.getElementById('unzipped-files-container');
    unzippedFilesContainer.innerHTML = ''; // Clear previous results

    const reader = new FileReader();
    reader.onload = async function(event) {
        const zip = new JSZip();
        const contents = await zip.loadAsync(event.target.result);
        for (const [filename, fileContent] of Object.entries(contents.files)) {
            if (!fileContent.dir) {
                const fileBlob = await fileContent.async("blob");
                const downloadLink = document.createElement('a');
                downloadLink.href = URL.createObjectURL(fileBlob);
                downloadLink.download = filename;
                downloadLink.textContent = filename;
                downloadLink.style.display = 'block';
                downloadLink.style.marginBottom = '8px';
                unzippedFilesContainer.appendChild(downloadLink);
            }
        }
    };
    reader.readAsArrayBuffer(file);
}

async function unzipFromBase64() {
    const base64String = document.getElementById('unzip-base64-input').value;
    if (!base64String) {
        alert('Please enter Base64 zip data');
        return;
    }

    try {
        const binaryString = atob(base64String);
        const bytes = new Uint8Array(binaryString.length);
        for (let i = 0; i < binaryString.length; i++) {
            bytes[i] = binaryString.charCodeAt(i);
        }

        const unzippedFilesContainer = document.getElementById('unzipped-files-container');
        unzippedFilesContainer.innerHTML = '';

        const zip = new JSZip();
        const contents = await zip.loadAsync(bytes);
        for (const [filename, fileContent] of Object.entries(contents.files)) {
            if (!fileContent.dir) {
                const fileBlob = await fileContent.async("blob");
                const downloadLink = document.createElement('a');
                downloadLink.href = URL.createObjectURL(fileBlob);
                downloadLink.download = filename;
                downloadLink.textContent = filename;
                downloadLink.style.display = 'block';
                downloadLink.style.marginBottom = '8px';
                unzippedFilesContainer.appendChild(downloadLink);
            }
        }
    } catch (e) {
        alert('Invalid Base64 zip data or corrupted zip file');
    }
}

        // JSON Compare function
        function compareJson() {
            const json1Input = document.getElementById('json-compare-1').value.trim();
            const json2Input = document.getElementById('json-compare-2').value.trim();
            const resultDiv = document.getElementById('json-compare-result');

            try {
                const obj1 = JSON.parse(json1Input);
                const obj2 = JSON.parse(json2Input);

                const differences = findDifferences(obj1, obj2);
                
                if (differences.length === 0) {
                    resultDiv.innerHTML = '<span style="color: green; font-weight: 600;">✓ JSONs are identical</span>';
                } else {
                    let html = '<span style="color: red; font-weight: 600;">✗ Differences found:</span>\n\n';
                    differences.forEach(diff => {
                        html += `<span style="color: #e76f51;">• ${diff}</span>\n`;
                    });
                    resultDiv.innerHTML = html;
                }
            } catch (e) {
                resultDiv.innerHTML = '<span style="color: red;">Invalid JSON input: ' + e.message + '</span>';
            }
        }

        // XML Compare function
        function compareXml() {
            const xml1Input = document.getElementById('xml-compare-1').value.trim();
            const xml2Input = document.getElementById('xml-compare-2').value.trim();
            const resultDiv = document.getElementById('xml-compare-result');

            try {
                const parser = new DOMParser();
                const doc1 = parser.parseFromString(xml1Input, 'text/xml');
                const doc2 = parser.parseFromString(xml2Input, 'text/xml');

                // Check for parsing errors
                if (doc1.getElementsByTagName('parsererror').length > 0 || 
                    doc2.getElementsByTagName('parsererror').length > 0) {
                    throw new Error('XML parsing error');
                }

                const differences = findXmlDifferences(doc1.documentElement, doc2.documentElement);
                
                if (differences.length === 0) {
                    resultDiv.innerHTML = '<span style="color: green; font-weight: 600;">✓ XMLs are identical</span>';
                } else {
                    let html = '<span style="color: red; font-weight: 600;">✗ Differences found:</span>\n\n';
                    differences.forEach(diff => {
                        html += `<span style="color: #e76f51;">• ${diff}</span>\n`;
                    });
                    resultDiv.innerHTML = html;
                }
            } catch (e) {
                resultDiv.innerHTML = '<span style="color: red;">Invalid XML input: ' + e.message + '</span>';
            }
        }

        // Helper function to find differences in JSON objects
        function findDifferences(obj1, obj2, path = '') {
            const differences = [];

            if (typeof obj1 !== typeof obj2) {
                differences.push(`Type mismatch at ${path || 'root'}: ${typeof obj1} vs ${typeof obj2}`);
                return differences;
            }

            if (obj1 === null || obj2 === null) {
                if (obj1 !== obj2) {
                    differences.push(`Value mismatch at ${path || 'root'}: ${obj1} vs ${obj2}`);
                }
                return differences;
            }

            if (typeof obj1 !== 'object') {
                if (obj1 !== obj2) {
                    differences.push(`Value mismatch at ${path || 'root'}: ${obj1} vs ${obj2}`);
                }
                return differences;
            }

            const keys1 = Object.keys(obj1);
            const keys2 = Object.keys(obj2);
            const allKeys = new Set([...keys1, ...keys2]);

            allKeys.forEach(key => {
                const newPath = path ? `${path}.${key}` : key;
                if (!(key in obj1)) {
                    differences.push(`Missing key in JSON 1: ${newPath}`);
                } else if (!(key in obj2)) {
                    differences.push(`Missing key in JSON 2: ${newPath}`);
                } else {
                    differences.push(...findDifferences(obj1[key], obj2[key], newPath));
                }
            });

            return differences;
        }

        // Helper function to find differences in XML nodes
        function findXmlDifferences(node1, node2, path = '') {
            const differences = [];

            if (node1.nodeName !== node2.nodeName) {
                differences.push(`Tag name mismatch at ${path || 'root'}: ${node1.nodeName} vs ${node2.nodeName}`);
                return differences;
            }

            const currentPath = path ? `${path}/${node1.nodeName}` : node1.nodeName;

            // Compare attributes
            const attrs1 = node1.attributes || [];
            const attrs2 = node2.attributes || [];
            const attrMap1 = {};
            const attrMap2 = {};

            for (let i = 0; i < attrs1.length; i++) {
                attrMap1[attrs1[i].name] = attrs1[i].value;
            }
            for (let i = 0; i < attrs2.length; i++) {
                attrMap2[attrs2[i].name] = attrs2[i].value;
            }

            const allAttrNames = new Set([...Object.keys(attrMap1), ...Object.keys(attrMap2)]);
            allAttrNames.forEach(attrName => {
                if (!(attrName in attrMap1)) {
                    differences.push(`Missing attribute in XML 1 at ${currentPath}: ${attrName}`);
                } else if (!(attrName in attrMap2)) {
                    differences.push(`Missing attribute in XML 2 at ${currentPath}: ${attrName}`);
                } else if (attrMap1[attrName] !== attrMap2[attrName]) {
                    differences.push(`Attribute value mismatch at ${currentPath}/@${attrName}: ${attrMap1[attrName]} vs ${attrMap2[attrName]}`);
                }
            });

            // Compare text content
            const text1 = node1.childNodes[0]?.nodeValue?.trim() || '';
            const text2 = node2.childNodes[0]?.nodeValue?.trim() || '';
            if (text1 !== text2 && node1.childNodes.length === 1 && node2.childNodes.length === 1) {
                differences.push(`Text content mismatch at ${currentPath}: "${text1}" vs "${text2}"`);
            }

            // Compare child elements
            const children1 = Array.from(node1.children || []);
            const children2 = Array.from(node2.children || []);

            if (children1.length !== children2.length) {
                differences.push(`Child count mismatch at ${currentPath}: ${children1.length} vs ${children2.length}`);
            }

            const maxLen = Math.max(children1.length, children2.length);
            for (let i = 0; i < maxLen; i++) {
                if (children1[i] && children2[i]) {
                    differences.push(...findXmlDifferences(children1[i], children2[i], currentPath));
                }
            }

            return differences;
        }

        window.showSection = showSection;
        window.encodeText = encodeText;
        window.decodeText = decodeText;
        window.encodeImage = encodeImage;
        window.decodeImage = decodeImage;
        window.encodePDF = encodePDF;
        window.decodePDF = decodePDF;
        window.encodeXML = encodeXML;
        window.decodeXML = decodeXML;
         window.zipFiles = zipFiles;
        window.unzipFile = unzipFile;
      window.createJwt = createJwt;
      window.decodeJwt = decodeJwt;
      window.copyToClipboard = copyToClipboard;
        window.clearAllInputs = clearAllInputs;
        window.encryptMessage = encryptMessage;
        window.decryptMessage = decryptMessage;
        window.jsonToString = jsonToString;
        window.stringToJson = stringToJson;
        window.beautifyJson = beautifyJson;
        window.decodeZipBase64 = decodeZipBase64;
        window.unzipFromBase64 = unzipFromBase64;
        window.compareJson = compareJson;
        window.compareXml = compareXml;

    // Add download progress bar logic for image
    document.getElementById('download-link').addEventListener('click', function(e) {
        showBeautifulProgressBar('image-download-progress-container', 'image-download-progress-bar');
    });

    // Add download progress bar logic for PDF
    document.getElementById('pdf-result').addEventListener('click', function(e) {
        showBeautifulProgressBar('pdf-download-progress-container', 'pdf-download-progress-bar');
    });

    // Add download progress bar logic for DOC
    document.getElementById('doc-result').addEventListener('click', function(e) {
        showBeautifulProgressBar('pdf-download-progress-container', 'pdf-download-progress-bar');
    });

    // Helper for beautiful progress bar animation
    function showBeautifulProgressBar(containerId, barId) {
        const progressContainer = document.getElementById(containerId);
        const progressBar = document.getElementById(barId);
        progressContainer.style.display = 'block';
        progressBar.style.width = '0';
        // Optionally, randomize the gradient direction for more beauty
        progressBar.style.background = 'linear-gradient(90deg, #ffecd2 0%, #fcb69f 25%, #a1c4fd 50%, #c2e9fb 75%, #667eea 100%)';
        setTimeout(() => { progressBar.style.width = '100%'; }, 50);
        setTimeout(() => { progressContainer.style.display = 'none'; }, 1000);
    }

    // JSON to String Converter
    function jsonToString() {
        let input = document.getElementById('json2str-input').value.trim();
        let resultArea = document.getElementById('json2str-result');
        try {
            // If input doesn't start with {, try to wrap it
            if (!input.startsWith('{') && !input.startsWith('[')) {
                input = '{' + input + '}';
            }
            const obj = JSON.parse(input);
            resultArea.value = JSON.stringify(obj);
        } catch (e) {
            resultArea.value = 'Invalid JSON input.';
        }
    }

    // String to JSON Converter
    function stringToJson() {
        let input = document.getElementById('str2json-input').value.trim();
        let resultArea = document.getElementById('str2json-result');
        try {
            // Try to parse as JSON
            const obj = JSON.parse(input);
            resultArea.value = JSON.stringify(obj, null, 2);
        } catch (e) {
            resultArea.value = 'Invalid string for JSON parsing.';
        }
    }

    // Generate a random Auth Key (not like JWT, just a secure random string)
    function generateAuthKey(length = 64) {
        const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}|;:,.<>?';
        let result = '';
        const array = new Uint32Array(length);
        window.crypto.getRandomValues(array);
        for (let i = 0; i < length; i++) {
            result += charset[array[i] % charset.length];
        }
        return result;
    }

    // Generate Auth Key using C#-like JWT logic with all parameters
    function generateAuthKeyJS(credentials, validityMinutes) {

        const secret = "";
        const key = CryptoJS.enc.Base64.parse(secret);

        // Simulate Utilities.Encrypt(username) with base64 (replace with real encryption if needed)
        const parts = credentials.split('|');
        if (parts.length !== 4) return '';

        const username = btoa(parts[0]); // simulate encrypt
        const userId = parts[1];
        const userLicense = parts[2];
        const password = parts[3];

        // JWT header
        const header = {
            alg: "HS256",
            typ: "JWT"
        };

        // JWT payload (mimic C# ClaimsIdentity)
        const now = Math.floor(Date.now() / 1000);
        const payload = {
            name: username,
            userId: userId,
            userLicense: userLicense,
            password: password,
            nbf: now, // Not Before
            iat: now, // Issued At
            exp: now + (validityMinutes * 60) // Expiry
        };

        // Base64Url encode
        function base64UrlEncode(obj) {
            return btoa(JSON.stringify(obj))
                .replace(/=/g, '')
                .replace(/\+/g, '-')
                .replace(/\//g, '_');
        }

        const encodedHeader = base64UrlEncode(header);
        const encodedPayload = base64UrlEncode(payload);
        const data = encodedHeader + "." + encodedPayload;

        // HMACSHA256 signature
        function base64UrlFromWordArray(wordArray) {
            return CryptoJS.enc.Base64.stringify(wordArray)
                .replace(/=/g, '')
                .replace(/\+/g, '-')
                .replace(/\//g, '_');
        }
        const signature = CryptoJS.HmacSHA256(data, key);
        const encodedSignature = base64UrlFromWordArray(signature);

        return data + "." + encodedSignature;
    }

    // Example usage:
    // let authKey = generateAuthKeyJS("help@syntizen.com|106|JUPUB-MNYOI-GQEEZ-NGSYD|SYNDEV", 60);
    // alert(authKey);

    // JSON Beautifier function with collapsible viewer and line numbers
    function beautifyJson() {
        const input = document.getElementById('jsonbeautify-input').value;
        const viewer = document.getElementById('json-collapsible-viewer');
        const lineNumbers = document.getElementById('json-line-numbers');
        try {
            const obj = JSON.parse(input);
            // Render with all nodes open by default
            viewer.innerHTML = renderCollapsibleJson(obj, 0, true);
            // Add line numbers
            setTimeout(() => {
                const lines = viewer.innerText.split('\n').length;
                let nums = '';
                for (let i = 1; i <= lines; i++) nums += i + '<br>';
                lineNumbers.innerHTML = nums;
            }, 0);
        } catch (e) {
            viewer.innerHTML = '<span style="color:red;">Invalid JSON input.</span>';
            lineNumbers.innerHTML = '';
        }
    }

    // Helper to render collapsible JSON, openAll = true to open all nodes initially
    function renderCollapsibleJson(obj, level = 0, openAll = false) {
        if (typeof obj !== 'object' || obj === null) {
            return `<span style="color:#0b6;">${JSON.stringify(obj)}</span>`;
        }
        const isArray = Array.isArray(obj);
        const keys = isArray ? obj : Object.keys(obj);
        if (keys.length === 0) {
            return isArray ? '[ ]' : '{ }';
        }
        const id = 'json-collapsible-' + Math.random().toString(36).substr(2, 9);
        let html = `<div style="margin-left:${level * 18}px;">`;
        html += `<span class="json-toggle" data-target="${id}" style="cursor:pointer;user-select:none;">${openAll ? '&#9660;' : '&#9654;'}</span> `;
        html += isArray
            ? `[<span id="${id}" style="display:${openAll ? '' : 'none'};">`
            : `{<span id="${id}" style="display:${openAll ? '' : 'none'};">`;
        html += '<br>';
        let idx = 0;
        for (let k in obj) {
            if (isArray) {
                html += renderCollapsibleJson(obj[k], level + 1, openAll);
            } else {
                html += `<span style="margin-left:${(level + 1) * 18}px;color:#b35;">"${k}"</span>: `;
                html += renderCollapsibleJson(obj[k], level + 1, openAll);
            }
            if (++idx < keys.length) html += ',<br>';
            else html += '<br>';
        }
        html += isArray ? ']' : '}';
        html += '</span></div>';
        return html;
    }

    // Toggle open/close for JSON objects/arrays and update line numbers
    document.addEventListener('click', function (e) {
        if (e.target.classList.contains('json-toggle')) {
            const targetId = e.target.getAttribute('data-target');
            const el = document.getElementById(targetId);
            if (el) {
                // Toggle open/close
                const isOpening = el.style.display === 'none';
                el.style.display = isOpening ? '' : 'none';
                e.target.innerHTML = isOpening ? '&#9660;' : '&#9654;'; // down or right arrow

                // Optionally, auto-close all child nodes when closing a parent
                if (!isOpening) {
                    // Find all descendant .json-toggle elements and close them
                    const descendants = el.querySelectorAll('.json-toggle');
                    descendants.forEach(function(toggle) {
                        const childId = toggle.getAttribute('data-target');
                        const childEl = document.getElementById(childId);
                        if (childEl && childEl.style.display !== 'none') {
                            childEl.style.display = 'none';
                            toggle.innerHTML = '&#9654;'; // right arrow
                        }
                    });
                }

                // Update line numbers after toggle
                setTimeout(() => {
                    const viewer = document.getElementById('json-collapsible-viewer');
                    const lineNumbers = document.getElementById('json-line-numbers');
                    const lines = viewer.innerText.split('\n').length;
                    let nums = '';
                    for (let i = 1; i <= lines; i++) nums += i + '<br>';
                    lineNumbers.innerHTML = nums;
                }, 0);

                // Dynamically increase textarea height if open
                setTimeout(() => {
                    const ta = document.getElementById('jsonbeautify-input');
                    if (ta) autoResizeTextarea(ta);
                }, 10);
            }
        }
    });

    // Dynamically auto-resize all textareas in all operations
    function autoResizeTextarea(el) {
        el.style.height = 'auto';
        el.style.height = (el.scrollHeight + 2) + 'px';
    }

    function attachAutoResizeToAllTextareas() {
        const textareas = document.querySelectorAll('textarea');
        textareas.forEach(function (ta) {
            ta.addEventListener('input', function () {
                autoResizeTextarea(ta);
            });
            // Initial resize for pre-filled content
            autoResizeTextarea(ta);
        });
    }

    // Update line numbers inside the textarea for JSON Beautifier input
    function updateJsonBeautifierInputLines() {
        const ta = document.getElementById('jsonbeautify-input');
        const linesDiv = document.getElementById('jsonbeautify-input-lines');
        if (!ta || !linesDiv) return;
        const lines = ta.value.split('\n').length || 1;
        let nums = '';
        for (let i = 1; i <= lines; i++) nums += i + '\n';
        linesDiv.textContent = nums;
        // Sync scroll
        linesDiv.scrollTop = ta.scrollTop;
        // Match height
        linesDiv.style.height = ta.offsetHeight + 'px';
    }
    function attachJsonBeautifierInputLineNumbers() {
        const ta = document.getElementById('jsonbeautify-input');
        const linesDiv = document.getElementById('jsonbeautify-input-lines');
        if (!ta || !linesDiv) return;
        updateJsonBeautifierInputLines();
        ta.addEventListener('input', updateJsonBeautifierInputLines);
        ta.addEventListener('scroll', () => { linesDiv.scrollTop = ta.scrollTop; });
        ta.addEventListener('keyup', updateJsonBeautifierInputLines);
        // Also update on resize
        new ResizeObserver(updateJsonBeautifierInputLines).observe(ta);
    }

    document.addEventListener('DOMContentLoaded', function () {
        attachAutoResizeToAllTextareas();
        attachJsonBeautifierInputLineNumbers();
    });

    const _origShowSection = showSection;
    showSection = function () {
        _origShowSection();
        setTimeout(() => {
            attachAutoResizeToAllTextareas();
            attachJsonBeautifierInputLineNumbers();
        }, 50);
    };
    </script>
</body>

</html>

